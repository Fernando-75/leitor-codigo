<!DOCTYPE html>
<html>
<head>
    <title>Assistente OJA - Mem√≥ria de Dilig√™ncias</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Segoe UI, Tahoma, Helvetica, sans-serif; padding: 15px; background-color: #eceff1; color: #333; }
        .container { max-width: 800px; margin: auto; background-color: #ffffff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h2, h3 { color: #00695c; border-bottom: 2px solid #b2dfdb; padding-bottom: 8px; }
        label { display: block; margin-top: 12px; font-weight: bold; font-size: 0.9em; }
        input, textarea, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #cfd8dc; border-radius: 6px; box-sizing: border-box; }
        .row { display: flex; gap: 10px; flex-wrap: wrap; }
        .col { flex: 1; min-width: 200px; }
        button { background-color: #00796b; color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.2s; }
        button:hover { background-color: #004d40; }
        .btn-sec { background-color: #546e7a; }
        .output-section { background-color: #f1f8e9; padding: 15px; border: 1.5px solid #c8e6c9; border-radius: 8px; margin-top: 15px; }
        textarea { height: 150px; font-family: Courier New, monospace; font-size: 0.95em; }
        .history-card { background: #fff; border: 1px solid #ddd; padding: 10px; margin-top: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 0.85em; }
        .history-actions button { padding: 5px 10px; font-size: 0.8em; margin: 2px; }
        .check-group { background: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px dashed #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h2>Assistente Digital OJA - Muria√©</h2>

    <h3>1. Identifica√ß√£o do Servidor</h3>
    <input type="text" id="nome_servidor" value="Oficial de Justi√ßa Fernando do Carmo de Morais, PJPI023297-5">
    <button class="btn-sec" onclick="salvarServidor()">üíæ Salvar Identifica√ß√£o</button>

    <h3>2. Dados do Mandado</h3>
    <label>C√≥digo de Barras (26 d√≠gitos) ou N√∫mero do Processo:</label>
    <input type="text" id="cod_completo" placeholder="Cole aqui..." oninput="processarEntrada(this.value)">
    
    <div class="row">
        <div class="col">
            <label>Nome do Jurisdicionado:</label>
            <input type="text" id="nome_parte" placeholder="Nome Completo">
        </div>
        <div class="col">
            <label>Vara/Secretaria:</label>
            <input type="text" id="nome_vara" value="2¬™ Vara C√≠vel">
        </div>
    </div>

    <div class="check-group">
        <strong>Op√ß√µes para Certid√£o:</strong>
        <div class="row" style="margin-top:10px;">
            <div class="col"><label><input type="checkbox" id="chk_identidade"> Confirmou Identidade</label></div>
            <div class="col"><label><input type="checkbox" id="chk_leitura"> Confirmou Leitura</label></div>
        </div>
        <div class="row">
            <div class="col">
                <label>In√≠cio do Contato:</label>
                <input type="datetime-local" id="data_inicio">
            </div>
            <div class="col">
                <label>Fim/Confirma√ß√£o:</label>
                <input type="datetime-local" id="data_fim">
            </div>
        </div>
    </div>

    <h3>3. A√ß√µes e Gerador</h3>
    <div class="row">
        <button onclick="gerarMensagemInicial()" style="flex:2">üí¨ Gerar Mensagem (Abordagem)</button>
        <button class="btn-sec" onclick="salvarNoHistorico()">üì• Salvar p/ Certificar Depois</button>
    </div>
    <div class="row">
        <button onclick="gerarCertidao(true)" style="background:#2e7d32">üìÑ Certid√£o POSITIVA</button>
        <button onclick="gerarCertidao(false)" style="background:#c62828">üìÑ Certid√£o INFRUT√çFERA</button>
    </div>

    <div class="output-section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <strong>Texto Gerado:</strong>
            <button onclick="copiarTexto()" style="padding:5px 10px; margin:0;">Copiar</button>
        </div>
        <textarea id="output_texto"></textarea>
    </div>

    <h3>4. Hist√≥rico de Dilig√™ncias Pendentes (10 dias)</h3>
    <div id="lista_historico"></div>
    <button class="btn-sec" onclick="limparHistorico()" style="width:100%; margin-top:20px; background:#90a4ae">Limpar Hist√≥rico Antigo</button>
</div>

<script>
    // Carregar dados ao iniciar
    window.onload = function() {
        const salvo = localStorage.getItem('oja_identidade');
        if(salvo) document.getElementById('nome_servidor').value = salvo;
        limparHistoricoAntigo();
        renderizarHistorico();
    };

    function salvarServidor() {
        localStorage.setItem('oja_identidade', document.getElementById('nome_servidor').value);
        alert("Servidor salvo!");
    }

    function processarEntrada(val) {
        if(val.length === 26) {
            const proc = `${val.substring(4,11)}-${val.substring(11,13)}.${val.substring(13,17)}.${val.substring(17,18)}.${val.substring(18,20)}.${val.substring(20,24)}`;
            document.getElementById('cod_completo').value = proc;
        }
    }

    function gerarMensagemInicial() {
        const parte = document.getElementById('nome_parte').value || "Sr(a)";
        const proc = document.getElementById('cod_completo').value;
        const servidor = document.getElementById('nome_servidor').value;
        
        const msg = `*TJMG - COMARCA DE MURIA√â*\n*Oficial:* ${servidor}\n\nPrezado(a) ${parte},\nContato oficial para cumprimento de *Mandado Judicial* (Proc: ${proc}), conforme *Portaria 7.047/CGJ/2022*.\n\nPara sua seguran√ßa, valide sua identidade informando:\n1. Nome Completo;\n2. 4 √∫ltimos d√≠gitos do CPF;\n3. Data de Nascimento.\n\nAp√≥s confer√™ncia, o mandado ser√° enviado.\n*D√∫vidas:* F√≥rum (32) 3729-3100 / Central 3729-3125.\n*Prazo: 24h.*`;
        
        document.getElementById('output_texto').value = msg;
        document.getElementById('data_inicio').value = new Date().toISOString().slice(0, 16);
    }

    function gerarCertidao(positiva) {
        const parte = document.getElementById('nome_parte').value;
        const proc = document.getElementById('cod_completo').value;
        const servidor = document.getElementById('nome_servidor').value;
        const vara = document.getElementById('nome_vara').value;
        const d_ini = new Date(document.getElementById('data_inicio').value).toLocaleString('pt-BR');
        const d_fim = new Date(document.getElementById('data_fim').value).toLocaleString('pt-BR');

        let cert = "";
        if(positiva) {
            cert = `CERTID√ÉO POSITIVA - MEIO ELETR√îNICO\n\nCertifico que em cumprimento ao Mandado Judicial (Proc: ${proc}), realizei a dilig√™ncia via WhatsApp. O contato iniciou-se em ${d_ini}. A parte ${parte} confirmou sua identidade e aceitou o recebimento do ato. O teor do mandado foi enviado e a ci√™ncia inequ√≠voca ocorreu em ${d_fim}. Devolvo √† ${vara}.\n\nMuria√©, ${new Date().toLocaleDateString('pt-BR')}.\n\n${servidor}`;
        } else {
            cert = `CERTID√ÉO INFRUT√çFERA - MEIO ELETR√îNICO\n\nCertifico que tentei realizar a dilig√™ncia via WhatsApp (Portaria 7.047/CGJ/2022) no Proc: ${proc} com a parte ${parte}. O contato inicial foi em ${d_ini}, por√©m, decorrido o prazo de 24h, n√£o houve resposta ou houve recusa na identifica√ß√£o. Devolvo √† ${vara} para fins de direito.\n\nMuria√©, ${new Date().toLocaleDateString('pt-BR')}.\n\n${servidor}`;
        }
        document.getElementById('output_texto').value = cert;
    }

    function salvarNoHistorico() {
        const item = {
            id: Date.now(),
            data_reg: new Date().toISOString(),
            parte: document.getElementById('nome_parte').value,
            proc: document.getElementById('cod_completo').value,
            vara: document.getElementById('nome_vara').value,
            data_inicio: document.getElementById('data_inicio').value
        };
        let h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        h.unshift(item);
        localStorage.setItem('oja_historico', JSON.stringify(h));
        renderizarHistorico();
        alert("Salvo no hist√≥rico para certid√µes futuras.");
    }

    function renderizarHistorico() {
        const h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        const div = document.getElementById('lista_historico');
        div.innerHTML = h.map(i => `
            <div class="history-card">
                <div>
                    <strong>${i.parte || 'Sem nome'}</strong><br>
                    ${i.proc} | <small>${new Date(i.data_reg).toLocaleDateString()}</small>
                </div>
                <div class="history-actions">
                    <button onclick="carregarItem(${i.id})">Carregar ‚¨ÜÔ∏è</button>
                    <button style="background:#e57373" onclick="deletarItem(${i.id})">X</button>
                </div>
            </div>
        `).join('');
    }

    function carregarItem(id) {
        const h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        const i = h.find(x => x.id === id);
        if(i) {
            document.getElementById('nome_parte').value = i.parte;
            document.getElementById('cod_completo').value = i.proc;
            document.getElementById('nome_vara').value = i.vara;
            document.getElementById('data_inicio').value = i.data_inicio;
            window.scrollTo(0,0);
        }
    }

    function deletarItem(id) {
        let h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        h = h.filter(x => x.id !== id);
        localStorage.setItem('oja_historico', JSON.stringify(h));
        renderizarHistorico();
    }

    function limparHistoricoAntigo() {
        let h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        const dezDias = 10 * 24 * 60 * 60 * 1000;
        h = h.filter(i => (Date.now() - new Date(i.data_reg).getTime()) < dezDias);
        localStorage.setItem('oja_historico', JSON.stringify(h));
    }

    function copiarTexto() {
        const t = document.getElementById('output_texto');
        t.select();
        document.execCommand('copy');
        alert("Texto copiado!");
    }
</script>

</body>
</html>
