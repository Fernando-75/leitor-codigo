<!DOCTYPE html>
<html>
<head>
    <title>Assistente OJA - Muria√© (Oficial)</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Times New Roman', serif; padding: 15px; background-color: #f4f4f4; color: #000; }
        .container { max-width: 850px; margin: auto; background-color: #fff; padding: 30px; border: 1px solid #ccc; box-shadow: 5px 5px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; text-decoration: underline; color: #1a237e; font-size: 1.4em; }
        label { display: block; margin-top: 15px; font-weight: bold; text-transform: uppercase; font-size: 0.85em; }
        input, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #999; border-radius: 2px; box-sizing: border-box; font-size: 1em; }
        .row { display: flex; gap: 15px; margin-bottom: 10px; }
        .col { flex: 1; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 12px; font-weight: bold; cursor: pointer; text-transform: uppercase; border: 1px solid #666; transition: 0.2s; }
        .btn-msg { background-color: #e8eaf6; color: #1a237e; }
        .btn-save { background-color: #fffde7; color: #f57f17; }
        .btn-pos { background-color: #e8f5e9; color: #1b5e20; }
        .btn-neg { background-color: #ffeae8; color: #b71c1c; }
        button:hover { filter: brightness(0.9); }
        .output-section { margin-top: 25px; border-top: 2px double #333; padding-top: 20px; }
        textarea#output_texto { height: 280px; background-color: #fafafa; font-size: 1.05em; line-height: 1.5; border: 1px solid #333; }
        .history-card { border: 1px solid #333; padding: 10px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; background: #fff; border-left: 10px solid #1a237e; }
        .history-info { line-height: 1.4; }
    </style>
</head>
<body>

<div class="container">
    <h2>ASSISTENTE JUDICIAL - COMARCA DE MURIA√â/MG</h2>

    <label>Identifica√ß√£o do Oficial de Justi√ßa:</label>
    <input type="text" id="nome_servidor" value="Fernando do Carmo de Morais, Oficial de Justi√ßa, matr√≠cula: PJPI023297-5">
    
    <div class="row">
        <div class="col">
            <label>Processo Judicial / Mandado:</label>
            <input type="text" id="cod_completo" placeholder="N√∫mero CNJ ou C√≥digo de Barras" oninput="formatarEntrada(this.value)">
        </div>
        <div class="col">
            <label>Nome do Jurisdicionado(a):</label>
            <input type="text" id="nome_parte" placeholder="Nome Completo">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Vara / Secretaria:</label>
            <input type="text" id="nome_vara" value="2¬™ Vara C√≠vel">
        </div>
        <div class="col">
            <label>In√≠cio do Contato:</label>
            <input type="datetime-local" id="data_inicio">
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-msg" onclick="gerarMensagemInicial()">üí¨ Gerar Mensagem WhatsApp</button>
        <button class="btn-save" onclick="salvarNoHistorico()">üì• Salvar p/ Certid√£o Depois</button>
        <button class="btn-pos" onclick="gerarCertidao(true)">‚öñÔ∏è Certid√£o Positiva</button>
        <button class="btn-neg" onclick="gerarCertidao(false)">‚öñÔ∏è Certid√£o Infrut√≠fera</button>
    </div>

    <div class="output-section">
        <div style="display:flex; justify-content:space-between; margin-bottom: 5px;">
            <strong>TEXTO PARA C√ìPIA:</strong>
            <button onclick="copiarTexto()">Copiar Texto</button>
        </div>
        <textarea id="output_texto" readonly></textarea>
    </div>

    <h3 style="margin-top:30px; font-size: 1em; text-decoration: underline;">DILIG√äNCIAS EM ANDAMENTO (Muria√©/MG)</h3>
    <div id="lista_historico"></div>
</div>

<script>
    window.onload = function() {
        limparHistoricoAntigo();
        renderizarHistorico();
        document.getElementById('data_inicio').value = new Date().toISOString().slice(0, 16);
    };

    function formatarEntrada(val) {
        if(val.length === 26) {
            const proc = `${val.substring(4,11)}-${val.substring(11,13)}.${val.substring(13,17)}.${val.substring(17,18)}.${val.substring(18,20)}.${val.substring(20,24)}`;
            document.getElementById('cod_completo').value = proc;
        }
    }

    function gerarMensagemInicial() {
        const parte = document.getElementById('nome_parte').value || "[NOME DA PARTE]";
        const proc = document.getElementById('cod_completo').value || "[PROCESSO]";
        const servidor = document.getElementById('nome_servidor').value;
        
        // Texto com asteriscos colados para negrito no WhatsApp
        const msg = `Bom dia/Boa tarde!\n\nPrezado(a) Sr.(a) *${parte}*,\n\nEste contato est√° sendo realizado por *${servidor}*, Servidor P√∫blico do Tribunal de Justi√ßa de Minas Gerais, de forma excepcional, em conformidade com a *PORTARIA N¬∫ 7.047/CGJ/2022*.\n\nO presente contato visa o cumprimento de *MANDADO JUDICIAL* referente ao *PROCESSO: ${proc}*.\n\nPara seguran√ßa do ato e validade da dilig√™ncia eletr√¥nica (Resolu√ß√£o CNJ n¬∫ 354/2020), √© *IMPRESCIND√çVEL* que V. Sa. confirme sua identidade informando:\n\n1. *Nome Completo*\n2. *4 √∫ltimos d√≠gitos do CPF*\n3. *Data de Nascimento*\n\nAp√≥s a referida valida√ß√£o, enviaremos o teor do Mandado. Em caso de d√∫vidas, contatar o F√≥rum de Muria√©: (32) 3729-3100 ou Central de Mandados: (32) 3729-3125.`;
        
        document.getElementById('output_texto').value = msg;
    }

    function gerarCertidao(positiva) {
        const parte = document.getElementById('nome_parte').value;
        const proc = document.getElementById('cod_completo').value;
        const servidor = document.getElementById('nome_servidor').value;
        const vara = document.getElementById('nome_vara').value;
        const d_ini = new Date(document.getElementById('data_inicio').value).toLocaleString('pt-BR');
        const agora = new Date().toLocaleString('pt-BR');

        if(positiva) {
            document.getElementById('output_texto').value = `CERTID√ÉO DE DILIG√äNCIA POSITIVA (MEIO ELETR√îNICO)\n\nCERTIFICO e dou f√© que, em cumprimento ao r. Mandado Judicial expedido nos autos do processo n¬∫ ${proc}, diligenciei o ato por meio do aplicativo WhatsApp Business. O contato com a parte ${parte} foi iniciado em ${d_ini}. Ap√≥s a devida identifica√ß√£o deste Oficial de Justi√ßa e a confirma√ß√£o dos dados pessoais por parte do destinat√°rio, este aceitou o recebimento do ato processual por via eletr√¥nica. O teor integral do mandado foi devidamente enviado, tendo a parte exarado ci√™ncia inequ√≠voca em ${agora}. Devolvo o presente mandado √† ${vara} para os devidos fins.\n\nMuria√©, ${new Date().toLocaleDateString('pt-BR')}.\n\n${servidor}`;
        } else {
            document.getElementById('output_texto').value = `CERTID√ÉO DE DILIG√äNCIA INFRUT√çFERA (MEIO ELETR√îNICO)\n\nCERTIFICO e dou f√© que, em cumprimento ao r. Mandado Judicial referente ao processo n¬∫ ${proc}, tentei realizar a dilig√™ncia por meio eletr√¥nico, conforme facultado pela Portaria 7.047/CGJ/2022. O contato inicial com a parte ${parte} ocorreu em ${d_ini}. Todavia, decorrido o prazo regulamentar, n√£o houve resposta √† solicita√ß√£o de identifica√ß√£o ou houve recusa em fornecer os dados necess√°rios para a seguran√ßa do ato, o que obsta a garantia da autenticidade da comunica√ß√£o. Ante a impossibilidade de confirmar a identidade do destinat√°rio e a ci√™ncia do ato, devolvo o mandado √† ${vara} sem o devido cumprimento.\n\nMuria√©, ${new Date().toLocaleDateString('pt-BR')}.\n\n${servidor}`;
        }
    }

    function salvarNoHistorico() {
        const item = {
            id: Date.now(),
            data_reg: new Date().toISOString(),
            parte: document.getElementById('nome_parte').value,
            proc: document.getElementById('cod_completo').value,
            vara: document.getElementById('nome_vara').value,
            data_inicio: document.getElementById('data_inicio').value
        };
        let h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        h.unshift(item);
        localStorage.setItem('oja_historico', JSON.stringify(h));
        renderizarHistorico();
        alert("Dados salvos. Voc√™ pode carregar este registro em at√© 10 dias para gerar a certid√£o.");
    }

    function renderizarHistorico() {
        const h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        const div = document.getElementById('lista_historico');
        div.innerHTML = h.map(i => `
            <div class="history-card">
                <div class="history-info">
                    <strong>${i.parte || '[SEM NOME]'}</strong><br>
                    <small>Proc: ${i.proc}</small><br>
                    <small>In√≠cio: ${new Date(i.data_inicio).toLocaleString('pt-BR')}</small>
                </div>
                <div>
                    <button onclick="carregarItem(${i.id})" style="background:#e8eaf6; color:#1a237e;">Carregar ‚¨ÜÔ∏è</button>
                    <button onclick="deletarItem(${i.id})" style="background:#fff; color:#b71c1c;">Apagar</button>
                </div>
            </div>
        `).join('');
    }

    function carregarItem(id) {
        const h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        const i = h.find(x => x.id === id);
        if(i) {
            document.getElementById('nome_parte').value = i.parte;
            document.getElementById('cod_completo').value = i.proc;
            document.getElementById('nome_vara').value = i.vara;
            document.getElementById('data_inicio').value = i.data_inicio;
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    }

    function deletarItem(id) {
        let h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        h = h.filter(x => x.id !== id);
        localStorage.setItem('oja_historico', JSON.stringify(h));
        renderizarHistorico();
    }

    function limparHistoricoAntigo() {
        let h = JSON.parse(localStorage.getItem('oja_historico') || '[]');
        const dezDias = 10 * 24 * 60 * 60 * 1000;
        h = h.filter(i => (Date.now() - new Date(i.data_reg).getTime()) < dezDias);
        localStorage.setItem('oja_historico', JSON.stringify(h));
    }

    function copiarTexto() {
        const t = document.getElementById('output_texto');
        t.select();
        document.execCommand('copy');
        alert("Texto copiado para a √°rea de transfer√™ncia.");
    }
</script>

</body>
</html>
